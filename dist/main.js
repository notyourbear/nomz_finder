const defaultLocation={lat:37.78,lng:-122.4},defaultZoom=14,listItemHeight=200,mapBaseHeight="275px",mapLargeHeight="470px",mapRefreshTime=1050,maxSearchItems=10,explainerText="Search for places or check ♥ for saved selections.",noSavedText="There are no saved selections.",noSearchResultsText="No results found.",initMap=()=>({map:new google.maps.Map(document.getElementById("map"),{center:defaultLocation,zoom:14})}),mapData={map:new google.maps.Map(document.getElementById("map"),{center:defaultLocation,zoom:14})},centerOn=(e,a)=>a.panTo(e.getPosition()),clear=e=>e.setMap(null),clearMarkers=e=>{e.forEach(e=>clear(e)),e.length=0},create=(e,a)=>{const t=new google.maps.Marker({map:a,position:{lat:e.lat,lng:e.lng},title:e.name,label:e.label});return t.addListener("click",scrollTo.bind(null,e.label)),t},createMarkers=(e,a)=>e.map(e=>create(e,a)),formatPlaceDetails=e=>{let a="";for(let t=0;t<e.price_level;t++)a+="$";let t="",r=Math.floor(e.rating);for(let e=0;e<r;e++)t+="★";return Object.assign({},{price_level:a,rating:t,lat:e.geometry.location.lat(),lng:e.geometry.location.lng(),address:e.formatted_address,name:e.name,place_id:e.place_id,favorited:!1})},scrollTo=e=>{const a=200*(parseInt(e)-1);document.querySelector(".list-container").scrollTop=a};var Marker={centerOn:(e,a)=>a.panTo(e.getPosition()),clearMarkers:e=>{e.forEach(e=>clear(e)),e.length=0},createMarkers:(e,a)=>e.map(e=>create(e,a)),formatPlaceDetails:e=>{let a="";for(let t=0;t<e.price_level;t++)a+="$";let t="",r=Math.floor(e.rating);for(let e=0;e<r;e++)t+="★";return Object.assign({},{price_level:a,rating:t,lat:e.geometry.location.lat(),lng:e.geometry.location.lng(),address:e.formatted_address,name:e.name,place_id:e.place_id,favorited:!1})},scrollTo:scrollTo};const itemTemplate=e=>{let a="favorite ml-auto pointer";return e.favorited&&(a+=" favorited"),`<li>\n    <div class='flex location-info'>\n      <div class='flex item'>\n        <h1> ${e.label}. </h1>\n        <h1> ${e.name} </h1>\n        <span class='pointer' data-index='${e.label}'>◉</span>\n      </div>\n      <div class='flex location-details item'>\n        <div>${e.rating}</div>\n        <div class='ml-auto pointer'>${e.price_level}</div>\n      </div>\n      <div class='flex location-details item'>\n        <p>${e.address}</p>\n        <div class="${a}" data-index='${e.label}' data-place_id='${e.place_id}'>\n          ${e.favorited?"♥":"♡"}\n        </div>\n      </div>\n    </div>\n  </li>`},emptyListTemplate=e=>`<li class='location-info explainer'><p>${e}</p></li>`,listLocation=document.querySelector("ul"),onClick=e=>listLocation.addEventListener("click",e),paint=(e,a)=>{listLocation.innerHTML="",0===e.length?listLocation.innerHTML=emptyListTemplate(a):e.forEach(e=>listLocation.innerHTML+=itemTemplate(e))};var List={paint:(e,a)=>{listLocation.innerHTML="",0===e.length?listLocation.innerHTML=emptyListTemplate(a):e.forEach(e=>listLocation.innerHTML+=itemTemplate(e))},onClick:e=>listLocation.addEventListener("click",e)};const checkIfFavorited=e=>new Promise((e,a)=>firebase.database().ref(`favorites/${e}`).once("value",a=>e(a.exists()))),getFavorites=()=>new Promise((e,a)=>firebase.database().ref("favorites").once("value",a=>{results=a.val();const t=null===results?[]:Object.values(results);return e(t.map((e,a)=>(e.label=""+(a+1),e)))})),favorite=e=>new Promise((a,t)=>a(firebase.database().ref(`favorites/${e.place_id}`).set({place_id:e.place_id,lat:e.lat,lng:e.lng,name:e.name,price_level:e.price_level,rating:e.rating,address:e.address,favorited:!0}))),unFavorite=e=>new Promise((e,a)=>e(firebase.database().ref(`favorites/${e.place_id}`).set(null)));var Dataflow={checkIfFavorited:e=>new Promise((a,t)=>firebase.database().ref(`favorites/${e}`).once("value",e=>a(e.exists()))),getFavorites:()=>new Promise((e,a)=>firebase.database().ref("favorites").once("value",a=>{results=a.val();const t=null===results?[]:Object.values(results);return e(t.map((e,a)=>(e.label=""+(a+1),e)))})),favorite:e=>new Promise((a,t)=>a(firebase.database().ref(`favorites/${e.place_id}`).set({place_id:e.place_id,lat:e.lat,lng:e.lng,name:e.name,price_level:e.price_level,rating:e.rating,address:e.address,favorited:!0}))),unFavorite:e=>new Promise((a,t)=>a(firebase.database().ref(`favorites/${e.place_id}`).set(null)))};const template$1=()=>`<div class="loader">\n    <div class="ball shadow-1"></div>\n    <div class="ball shadow-2"></div>\n    <div class="ball shadow-3"></div>\n    <div class="ball shadow-4"></div>\n    <div class="ball shadow-5"></div>\n    <div class="ball shadow-6"></div>\n  </div>`,list=document.querySelector("ul"),display=()=>list.innerHTML=template$1();var Loader={display:()=>list.innerHTML=template$1()};const map$1=document.querySelector("#map"),mapContainer=document.querySelector(".map-container"),buttonData={typeButtons:["favorites","search"],typeSelected:"search",mapButton:"fullscreenMap",largeMapView:!1},toggleMapViews=(e,a)=>{buttonData.typeButtons.includes(e.id)?(toggleSelectionButton(e,"typeSelected"),a.call(null,e.id)):e.id===buttonData.mapButton&&(buttonData.largeMapView?closeMapDisplay():openMapDisplay())},closeMapDisplay=()=>{buttonData.largeMapView&&(mapContainer.style.height="275px",buttonData.largeMapView=!1,setTimeout(()=>{map$1.style.height="275px",google.maps.event.trigger(map$1,"resize")},1050))},openMapDisplay=()=>{buttonData.largeMapView||(map$1.style.height="470px",mapContainer.style.height="470px",buttonData.largeMapView=!0,setTimeout(()=>{google.maps.event.trigger(map$1,"resize")},1050))},toggleSelectionButton=e=>{e.classList.toggle("selected"),document.querySelector(`#${buttonData.typeSelected}`).classList.toggle("selected"),buttonData.typeSelected=e.id};var OptionsBar={toggleMapViews:(e,a)=>{buttonData.typeButtons.includes(e.id)?(toggleSelectionButton(e,"typeSelected"),a.call(null,e.id)):e.id===buttonData.mapButton&&(buttonData.largeMapView?closeMapDisplay():openMapDisplay())},toggleSelectionButton:toggleSelectionButton};const getResults=(e,a)=>search(e,a).then(e=>(e=limitSearchResults(e),Promise.all(e.map((e,a)=>Dataflow.checkIfFavorited(e.place_id).then(t=>{const r=Marker.formatPlaceDetails(e);return r.label=""+(a+1),r.favorited=t,r}))))),limitSearchResults=e=>e.reduce((e,a,t)=>t<10?e.concat(a):e,[]),search=(e,a)=>{const t=new google.maps.places.PlacesService(a),r=a.getBounds();return new Promise((a,l)=>t.textSearch({bounds:r,query:e,type:"restaurant"},a))};var Search={getResults:(e,a)=>search(e,a).then(e=>(e=limitSearchResults(e),Promise.all(e.map((e,a)=>Dataflow.checkIfFavorited(e.place_id).then(t=>{const r=Marker.formatPlaceDetails(e);return r.label=""+(a+1),r.favorited=t,r})))))};const optionsBar=document.querySelector(".options-bar"),searchbar=document.querySelector("form"),input=document.querySelector('form > input[type="text"]'),map=mapData.map,data={current:"search",favorites:[],initSavedResults:!1,markers:[],search:[]};List.onClick(e=>{const a=e.target.getAttribute("data-index");if(null!==e.target.getAttribute("data-place_id")){const e=data[data.current][a-1];e.favorited?Dataflow.unFavorite(e).then(()=>{data.search=data.search.map((e,t)=>(a-1===t&&(e.favorited=!1),e)),Dataflow.getFavorites().then(e=>{data.favorites=e,List.paint(data[data.current],noSavedText)})}):Dataflow.favorite(e).then(()=>{data.search=data.search.map((e,t)=>(a-1===t&&(e.favorited=!0),e)),Dataflow.getFavorites().then(e=>{data.favorites=e,List.paint(data.search,noSavedText)})})}else if(null!==a){const e=data.markers[a-1];Marker.centerOn(e,map)}}),optionsBar.addEventListener("click",e=>{OptionsBar.toggleMapViews(e.target,e=>{data.current=e,Marker.clearMarkers(data.markers),data.markers=Marker.createMarkers(data[e],map),"search"===e?List.paint(data[e],explainerText):data.initSavedResults?List.paint(data[e],noSavedText):Loader.display()})}),searchbar.addEventListener("submit",e=>{e.preventDefault(),Marker.clearMarkers(data.markers),Loader.display(),Search.getResults(input.value,map).then(e=>{data.current="search",data.search=e,data.markers=Marker.createMarkers(data.search,map),List.paint(e,"No results found."),OptionsBar.toggleSelectionButton(document.querySelector("#search"))})}),Dataflow.getFavorites().then(e=>{data.favorites=e,data.initSavedResults=!0,"favorites"===data.current&&(data.markers=Marker.createMarkers(data.favorites,map),List.paint(data.favorites,noSavedText))}),List.paint([],explainerText);